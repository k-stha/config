#!/usr/bin/env sh

set -euf

SCRIPT="${0##*/}"

# Print help menu.
# Arguments and Variables:
#     ${SCRIPT}: Name of the script
help()
{
    cat <<EOF
Usage: ${SCRIPT} [OPTION...]

Options:
  -h, --help        Display this help and exit
  -s, --select      Select a region to screenshot"
EOF
}

# Redirect error message to stderr and exit with error code.
# Arguments and Variables:
#     $*: Error Message
die()
{
    printf "%s\n" "$*" >&2
    exit 1
}

SCREENSHOT_DIR="${HOME}/Screenshots/"
SCREENSHOT="${SCREENSHOT_DIR}""$(date "+%Y-%m-%dT%H_%M_%S_%NZ")".png
SELECT=0

[ ! -d "${SCREENSHOT_DIR}" ] && mkdir -p "${SCREENSHOT_DIR}"

while [ "$#" -gt 0 ]; do
    case "${1}" in
        -h|--help)
            help
            exit 0
            ;;
        -s|--select)
            SELECT=1
            shift
            ;;
        *)
            die "Invalid parameter: ${1}"
            ;;
    esac
done

if [ "${SELECT}" = 1 ]; then
    grim -g "$(slurp)" "${SCREENSHOT}"
else
    grim "${SCREENSHOT}"
fi
